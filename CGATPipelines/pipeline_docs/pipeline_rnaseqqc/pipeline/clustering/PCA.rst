.. _PCA:

============================
Principal Component Analysis
============================

Summary
=======

Principal component analysis (PCA) is a way of transforming and visualising the 
datasets to enable the identification of the strong patterns that account for the 
majority of the variation between the datasets. 

See `here <http://sebastianraschka.com/Articles/2014_pca_step_by_step.html>_` 
for futher details on PCA analysis.

Results
=======

Plot of PCA analysis based on expression values (TPM) of all genes expressed 
in any of the samples. 

.. report:: RnaseqqcReport.SamplePCAProjections
   :render: r-ggplot
   :layout: columns-2
   :groupby: track
   :statement: aes(x=PC1, y=PC2, colour=factor_value, shape=replicate) +
	       geom_point() +
	       theme_bw() +
	       theme(
	       axis.text.x=element_text(size=20, angle=90, vjust=0.5, hjust=0),
	       axis.text.y=element_text(size=20),
	       axis.title.x=element_text(size=20),
	       axis.title.y=element_text(size=20),
	       legend.text=element_text(size=20),
	       legend.title=element_text(size=20),
	       aspect.ratio=1)

   Plots of First (PC1) and second (PC2) principal components from pricipal component
   analysis showing the latent variables that explain most of the variance in 
   the dataset. All three graphs are the same but are colored by different 
   experimental factors (labeled at top left of graph). 


.. report:: RnaseqqcReport.SamplePCAVariance
   :render: r-ggplot
   :statement: aes(x=PC, y=100*variance) +
	       ylab("Variance (%)") + xlab("PC") +
	       geom_bar(stat="identity") +
	       scale_x_continuous(breaks=seq(0,100,1)) +
	       theme_bw() +
	       theme(
	       axis.text.x=element_text(size=20),
	       axis.text.y=element_text(size=20),
	       axis.title.x=element_text(size=20),
	       axis.title.y=element_text(size=20),
	       aspect.ratio=1)

   Bar plot showing the amount of percentage variance each principal component 
   accounts for.

About this section
==================

Inputs
------
A table of expression values in TPM for each transcript and sample generated by 
sailfish and stored as the 'transcript_quantification' table in pipeline database

Outputs
-------
A scatter plot of the first two principal components, PC1 on the x axis and PC2
on the y axis. The way the datasets seperate along the x axis shows the factors 
that explain the most amount of variation in the dataset (PC1), whilst the
way the datasets seperate along the y axis shows the factors 
that explain the second most amount of variation in the datasets (PC2).

How the results are generated
-----------------------------

  1. Expression values are arranged in a dataframe organised such that there 
     is a row for each transcript and a columns for each sample.

  2. Expression values are filtered to remove any genes that where TPM is 0 
     across all of the samples.

  3. For each sample the expression values for remaining genes are log transformed 
     log2(TPM_count + 1).

  4. The dataframe is scaled and centered so that mean for each transcript across 
     all samples = 0 and standard deviation = 1.

  5. PCA analysis is computed for using sklearn PCA.decomposition.PCA method. 


What you should expect from results
-----------------------------------

**Scatter Plot - PC1 vs PC2**::

Ideally the first two principal components (PC1 and PC2) should
seperate and cluster the datasets according to the experimental design
e.g. by tissue type or by treatment.  If experimental design does not
seperate the datasets, this indicates there are other factors that are
having a greater influence on the expression values - these might be
things like batch-specific effects, sequencing lane, library prep or
other confounding factors and could affect the experimental results.

**Bar plot  of first 10 principal components**::

This plot shows the proportion of variance in the dataset that each
component accounts for.  Ideally you would want to see the first few
principal components with the higest values and accounting for most of
the variance before dropping rapidly down to low levels. If several
components have high levels of variance - the factors underlying these
might want to be considered when deciding on the course of action for
downstream analysis.
